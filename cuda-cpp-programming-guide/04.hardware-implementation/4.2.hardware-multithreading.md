## 4.2. 하드웨어 다중 스레딩

멀티프로세서에 의해 처리되는 각 워프의 실행 컨텍스트(프로그램 카운터, 레지스터 등)는 워프의 전체 수명 동안 온칩(on-chip)에서 유지됩니다. 따라서 하나의 실행 컨텍스트에서 다른 실행 컨텍스트로 전환하는 데는 비용이 들지 않으며, 각 명령어 발행 시점에 워프 스케줄러는 다음 명령어를 실행할 준비가 된 스레드(워프의 [활성 스레드](https://docs.nvidia.com/cuda/cuda-c-programming-guide/#simt-architecture-notes))를 가진 워프를 선택하고 해당 스레드에 명령어를 발행합니다.

특히, 각 멀티프로세서는 워프 간에 분할된 32비트 레지스터 집합과 스레드 블록 간에 분할된 *병렬 데이터 캐시* 또는 *공유 메모리*를 가지고 있습니다.

주어진 커널에 대해 멀티프로세서에서 함께 거주하고 처리될 수 있는 블록과 워프의 수는 커널에서 사용되는 레지스터와 공유 메모리의 양, 그리고 멀티프로세서에서 사용 가능한 레지스터와 공유 메모리의 양에 따라 달라집니다. 또한 각 멀티프로세서당 최대 거주 블록 수와 최대 거주 워프 수가 있습니다. 이러한 한계와 멀티프로세서에서 사용 가능한 레지스터 및 공유 메모리의 양은 장치의 컴퓨트 능력(Compute Capabilities)에 따라 달라진다. 각 멀티프로세서에서 최소한 하나의 블록을 처리할 수 있는 충분한 레지스터나 공유 메모리가 없으면 커널이 실행되지 않습니다.

블록 내의 총 워프 수는 다음과 같습니다:

$$
\text{Total number of warps per block} = ceil(\frac{T}{W_{size}}, 1)
$$

> $T$는 블록당 스레드 수입니다.
>
> $W_{size}$는 워프 크기로, 32와 같습니다.
>
> $ceil(x, y)$는 $x$를 $y$의 가장 가까운 배수로 올림한 값입니다.

블록에 할당된 총 레지스터 수와 총 공유 메모리 양은 CUDA Toolkit에서 제공하는 CUDA 점유율 계산기(CUDA Occupancy Calculator)에 문서화되어 있습니다.